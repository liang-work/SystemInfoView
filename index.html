<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿä¿¡æ¯ç›‘æ§é¢æ¿</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
            transition: all 0.3s ease;
        }

        body.dark-theme {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: #ecf0f1;
        }

        body.dark-theme .container {
            background: rgba(45, 52, 64, 0.95);
        }

        body.dark-theme .section {
            background: #34495e;
            border-color: #4a5f7a;
        }

        body.dark-theme .metric-card {
            background: #2c3e50;
        }

        body.dark-theme .cpu-core,
        body.dark-theme .memory-type,
        body.dark-theme .disk-item {
            background: #34495e;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.8;
            font-size: 1.1em;
        }

        .header-controls {
            position: absolute;
            top: 15px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .last-update {
            position: absolute;
            top: 15px;
            left: 20px;
            font-size: 0.9em;
            opacity: 0.7;
        }

        /* è®¾ç½®æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .modal-header h3 {
            margin: 0;
            color: #2c3e50;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .setting-group {
            margin-bottom: 20px;
        }

        .setting-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .setting-group input,
        .setting-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .theme-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .theme-option {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .theme-option.active {
            border-color: #667eea;
            background-color: #f0f2ff;
        }

        .lang-options {
            display: flex;
            gap: 10px;
        }

        .lang-option {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .lang-option.active {
            background-color: #667eea;
            color: white;
            border-color: #667eea;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 25px;
            padding: 30px;
        }

        .section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h2::before {
            content: '';
            width: 4px;
            height: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 2px;
        }

        .metric-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .metric-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .metric-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            color: white;
        }

        .metric-title {
            font-weight: 600;
            color: #2c3e50;
            flex: 1;
        }

        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
            font-family: 'Courier New', monospace;
        }

        .metric-subtitle {
            font-size: 0.85em;
            color: #666;
            margin-top: 2px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .cpu-cores {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }

        .cpu-core {
            text-align: center;
            padding: 8px;
            background: #f0f2f5;
            border-radius: 6px;
            font-size: 0.8em;
        }

        .cpu-core-value {
            font-weight: bold;
            color: #2c3e50;
        }

        .memory-types {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .memory-type {
            padding: 8px;
            background: #f0f2f5;
            border-radius: 6px;
            text-align: center;
        }

        .memory-label {
            font-size: 0.8em;
            color: #666;
        }

        .memory-value {
            font-weight: bold;
            color: #2c3e50;
        }

        .disk-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }

        .disk-item {
            text-align: center;
            padding: 10px;
            background: #f0f2f5;
            border-radius: 8px;
        }

        .network-info {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .network-item {
            text-align: center;
            flex: 1;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online {
            background: #27ae60;
            box-shadow: 0 0 10px rgba(39, 174, 96, 0.5);
        }

        .status-offline {
            background: #e74c3c;
            box-shadow: 0 0 10px rgba(231, 76, 60, 0.5);
        }

        .loading {
            text-align: center;
            color: #666;
            padding: 20px;
        }

        .error {
            color: #e74c3c;
            background: #ffeaea;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .refresh-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9em;
            margin: 10px;
            transition: transform 0.2s;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
        }

        .api-docs {
            grid-column: 1 / -1;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .api-docs h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        @media (max-width: 1200px) {
            .content {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            body {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ–¥ï¸ ç³»ç»Ÿä¿¡æ¯ç›‘æ§é¢æ¿</h1>
            <p>å®æ—¶æ˜¾ç¤ºç³»ç»Ÿæ€§èƒ½å’Œèµ„æºä½¿ç”¨æƒ…å†µ</p>
            <div class="header-controls">
                <button class="control-btn" onclick="openSettings()">
                    <i class="fas fa-cog"></i> è®¾ç½®
                </button>
                <button class="control-btn" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i> ä¸»é¢˜
                </button>
                <button class="control-btn" onclick="refreshAll()">
                    <i class="fas fa-sync-alt"></i> åˆ·æ–°
                </button>
            </div>
        </div>

        <div class="content">
            <div class="section">
                <h2>
                    <i class="fas fa-desktop"></i>
                    ç³»ç»Ÿä¿¡æ¯
                </h2>
                <div id="system-info">
                    <div class="loading">æ­£åœ¨åŠ è½½ç³»ç»Ÿä¿¡æ¯...</div>
                </div>
            </div>

            <div class="section">
                <h2>
                    <i class="fas fa-tachometer-alt"></i>
                    CPUçŠ¶æ€
                </h2>
                <div id="cpu-info">
                    <div class="loading">æ­£åœ¨åŠ è½½CPUä¿¡æ¯...</div>
                </div>
            </div>

            <div class="section">
                <h2>
                    <i class="fas fa-memory"></i>
                    å†…å­˜çŠ¶æ€
                </h2>
                <div id="memory-info">
                    <div class="loading">æ­£åœ¨åŠ è½½å†…å­˜ä¿¡æ¯...</div>
                </div>
            </div>

            <div class="section">
                <h2>
                    <i class="fas fa-hdd"></i>
                    ç£ç›˜çŠ¶æ€
                </h2>
                <div id="disk-info">
                    <div class="loading">æ­£åœ¨åŠ è½½ç£ç›˜ä¿¡æ¯...</div>
                </div>
            </div>

            <div class="section">
                <h2>
                    <i class="fas fa-network-wired"></i>
                    ç½‘ç»œçŠ¶æ€
                </h2>
                <div id="network-info">
                    <div class="loading">æ­£åœ¨åŠ è½½ç½‘ç»œä¿¡æ¯...</div>
                </div>
            </div>

            <div class="section">
                <h2>
                    <i class="fas fa-cog"></i>
                    ç³»ç»Ÿè¿›ç¨‹
                </h2>
                <div id="process-info">
                    <div class="loading">æ­£åœ¨åŠ è½½è¿›ç¨‹ä¿¡æ¯...</div>
                </div>
            </div>
        </div>

        <div class="api-docs">
            <h3>ğŸ“š API æ–‡æ¡£</h3>

            <div class="api-endpoint">
                <div class="method">GET</div>
                <div class="endpoint">/api/system/info</div>
                <p><strong>æè¿°ï¼š</strong>è·å–ç³»ç»ŸåŸºæœ¬ä¿¡æ¯</p>
                <p><strong>è¯·æ±‚å‚æ•°ï¼š</strong>æ— </p>
                <p><strong>é¢„æœŸè¿”å›å€¼ï¼š</strong></p>
                <pre>{
  "hostname": "æœåŠ¡å™¨ä¸»æœºå",
  "platform": "æ“ä½œç³»ç»Ÿå¹³å°",
  "arch": "ç³»ç»Ÿæ¶æ„",
  "cpu_count": CPUæ ¸å¿ƒæ•°,
  "total_memory": æ€»å†…å­˜å¤§å°(GB),
  "uptime": ç³»ç»Ÿè¿è¡Œæ—¶é—´(ç§’),
  "load_average": [1åˆ†é’Ÿ, 5åˆ†é’Ÿ, 15åˆ†é’Ÿå¹³å‡è´Ÿè½½],
  "timestamp": æ—¶é—´æˆ³
}</pre>
                <p><strong>Noneå€¼å¤„ç†ï¼š</strong>å¦‚æœè¿”å›nullï¼Œæ‰€æœ‰å­—æ®µæ˜¾ç¤ºä¸º"æœªçŸ¥"</p>
            </div>

            <div class="api-endpoint">
                <div class="method">GET</div>
                <div class="endpoint">/api/performance/resources</div>
                <p><strong>æè¿°ï¼š</strong>è·å–ç³»ç»Ÿæ€§èƒ½èµ„æºä¿¡æ¯</p>
                <p><strong>è¯·æ±‚å‚æ•°ï¼š</strong>æ— </p>
                <p><strong>é¢„æœŸè¿”å›å€¼ï¼š</strong></p>
                <pre>{
  "cpu_usage": CPUä½¿ç”¨ç‡ç™¾åˆ†æ¯”,
  "memory_usage": å†…å­˜ä½¿ç”¨ç‡ç™¾åˆ†æ¯”,
  "memory_used": å·²ç”¨å†…å­˜(GB),
  "memory_available": å¯ç”¨å†…å­˜(GB),
  "disk_usage": ç£ç›˜ä½¿ç”¨ç‡ç™¾åˆ†æ¯”,
  "disk_used": å·²ç”¨ç£ç›˜ç©ºé—´(GB),
  "disk_total": æ€»ç£ç›˜ç©ºé—´(GB),
  "network_rx": ç½‘ç»œæ¥æ”¶é€Ÿç‡(KB/s),
  "network_tx": ç½‘ç»œå‘é€é€Ÿç‡(KB/s),
  "timestamp": æ—¶é—´æˆ³
}</pre>
                <p><strong>Noneå€¼å¤„ç†ï¼š</strong>å¦‚æœè¿”å›nullï¼Œæ‰€æœ‰æ•°å€¼å­—æ®µæ˜¾ç¤ºä¸º"0"ï¼Œç™¾åˆ†æ¯”æ˜¾ç¤ºä¸º"0%"</p>
            </div>
        </div>
    </div>

    <!-- è®¾ç½®æ¨¡æ€æ¡† -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-cog"></i> ç³»ç»Ÿè®¾ç½®</h3>
                <span class="close" onclick="closeSettings()">&times;</span>
            </div>

            <div class="setting-group">
                <label for="refreshInterval">åˆ·æ–°é—´éš” (ç§’):</label>
                <input type="number" id="refreshInterval" min="1" max="60" value="2">
            </div>

            <div class="setting-group">
                <label>ä¸»é¢˜é€‰æ‹©:</label>
                <div class="theme-options">
                    <div class="theme-option" onclick="setTheme('light')" id="lightTheme">
                        <i class="fas fa-sun"></i> äº®è‰²ä¸»é¢˜
                    </div>
                    <div class="theme-option" onclick="setTheme('dark')" id="darkTheme">
                        <i class="fas fa-moon"></i> æš—è‰²ä¸»é¢˜
                    </div>
                </div>
            </div>

            <div class="setting-group">
                <label>è¯­è¨€é€‰æ‹©:</label>
                <div class="lang-options">
                    <div class="lang-option active" onclick="setLanguage('zh-CN')" id="langZh">
                        ä¸­æ–‡
                    </div>
                    <div class="lang-option" onclick="setLanguage('en-US')" id="langEn">
                        English
                    </div>
                </div>
            </div>

            <div class="setting-group">
                <button class="control-btn" onclick="saveSettings()" style="width: 100%; padding: 10px;">
                    <i class="fas fa-save"></i> ä¿å­˜è®¾ç½®
                </button>
            </div>
        </div>
    </div>

    <script>
        // é…ç½®
        const CONFIG = {
            API_BASE_URL: 'http://localhost:3000', // è¯·æ ¹æ®å®é™…åç«¯åœ°å€ä¿®æ”¹
            REFRESH_INTERVAL: 2000 // åˆ·æ–°é—´éš”ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤2ç§’
        };

        // çŠ¶æ€ç®¡ç†
        let refreshTimer = null;

        // å·¥å…·å‡½æ•°
        function formatBytes(bytes) {
            if (bytes === null || bytes === undefined) return 'æœªçŸ¥';
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            if (bytes === 0) return '0 B';
            const i = Math.floor(Math.log(bytes) / Math.log(1024));
            return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
        }

        function formatPercentage(value) {
            if (value === null || value === undefined) return '0%';
            // å¦‚æœå·²ç»æ˜¯å°æ•°å½¢å¼ï¼ˆ0.80ï¼‰ï¼Œè½¬æ¢ä¸ºç™¾åˆ†æ¯”ï¼ˆ80%ï¼‰
            const percentage = value < 1 ? value * 100 : value;
            return Math.round(percentage * 100) / 100 + '%';
        }

        function formatUptime(seconds) {
            if (seconds === null || seconds === undefined) return 'æœªçŸ¥';
            const days = Math.floor(seconds / 86400);
            const hours = Math.floor((seconds % 86400) / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            return `${days}å¤© ${hours}å°æ—¶ ${minutes}åˆ†é’Ÿ`;
        }

        function formatNumber(value) {
            if (value === null || value === undefined) return '0';
            return Math.round(value * 100) / 100;
        }

        // åˆ›å»ºä¿¡æ¯é¡¹å…ƒç´ 
        function createInfoItem(label, value) {
            const item = document.createElement('div');
            item.className = 'info-item';
            item.innerHTML = `
                <span class="info-label">${label}</span>
                <span class="info-value">${value}</span>
            `;
            return item;
        }

        // åˆ›å»ºæŒ‡æ ‡å¡ç‰‡
        function createMetricCard(iconClass, bgColor, title, value, subtitle = '', progress = null) {
            const card = document.createElement('div');
            card.className = 'metric-card';

            const icon = document.createElement('div');
            icon.className = 'metric-icon';
            icon.style.backgroundColor = bgColor;
            icon.innerHTML = `<i class="${iconClass}"></i>`;

            const header = document.createElement('div');
            header.className = 'metric-header';
            header.appendChild(icon);

            const titleEl = document.createElement('div');
            titleEl.className = 'metric-title';
            titleEl.textContent = title;
            header.appendChild(titleEl);

            const valueEl = document.createElement('div');
            valueEl.className = 'metric-value';
            valueEl.textContent = value;

            if (subtitle) {
                const subtitleEl = document.createElement('div');
                subtitleEl.className = 'metric-subtitle';
                subtitleEl.textContent = subtitle;
                valueEl.appendChild(subtitleEl);
            }

            card.appendChild(header);
            card.appendChild(valueEl);

            if (progress !== null) {
                const progressBar = document.createElement('div');
                progressBar.className = 'progress-bar';

                const progressFill = document.createElement('div');
                progressFill.className = 'progress-fill';
                progressFill.style.width = `${Math.min(progress * 100, 100)}%`;

                progressBar.appendChild(progressFill);
                card.appendChild(progressBar);
            }

            return card;
        }

        // æ›´æ–°ç³»ç»Ÿä¿¡æ¯
        async function updateSystemInfo() {
            const container = document.getElementById('system-info');

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/api/system/info`);
                const data = await response.json();

                container.innerHTML = '';

                // ç³»ç»ŸåŸºæœ¬ä¿¡æ¯
                container.appendChild(createMetricCard(
                    'fas fa-server',
                    '#e74c3c',
                    'ä¸»æœºå',
                    data.hostname || 'æœªçŸ¥'
                ));

                container.appendChild(createMetricCard(
                    'fab fa-windows',
                    '#3498db',
                    'æ“ä½œç³»ç»Ÿ',
                    `${data.platform || 'æœªçŸ¥'} ${data.release || ''}`
                ));

                container.appendChild(createMetricCard(
                    'fas fa-microchip',
                    '#9b59b6',
                    'å¤„ç†å™¨',
                    data.processor || 'æœªçŸ¥'
                ));

                container.appendChild(createMetricCard(
                    'fas fa-clock',
                    '#f39c12',
                    'ç³»ç»Ÿæ—¶é—´',
                    data.current_time || 'æœªçŸ¥'
                ));

                container.appendChild(createMetricCard(
                    'fab fa-python',
                    '#27ae60',
                    'Pythonç‰ˆæœ¬',
                    data.python_version || 'æœªçŸ¥'
                ));

                // æ›´æ–°æœ€ååˆ·æ–°æ—¶é—´
                updateLastRefreshTime();

            } catch (error) {
                console.error('è·å–ç³»ç»Ÿä¿¡æ¯å¤±è´¥:', error);
                container.innerHTML = '<div class="error">âŒ æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡ï¼Œè¯·æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ</div>';
            }
        }

        // æ›´æ–°CPUä¿¡æ¯
        async function updateCpuInfo() {
            const container = document.getElementById('cpu-info');

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/api/performance/resources`);
                const data = await response.json();

                container.innerHTML = '';

                // CPUä½¿ç”¨ç‡
                container.appendChild(createMetricCard(
                    'fas fa-tachometer-alt',
                    '#e74c3c',
                    'CPUä½¿ç”¨ç‡',
                    formatPercentage(data.cpu_usage),
                    '',
                    data.cpu_usage
                ));

                // CPUé¢‘ç‡
                container.appendChild(createMetricCard(
                    'fas fa-wave-square',
                    '#f39c12',
                    'å½“å‰é¢‘ç‡',
                    `${data.cpu_freq_current || 0} MHz`,
                    'CPUä¸»é¢‘'
                ));

                // CPUæ ¸å¿ƒæ•°
                container.appendChild(createMetricCard(
                    'fas fa-cubes',
                    '#9b59b6',
                    'ç‰©ç†æ ¸å¿ƒ',
                    `${data.cpu_count_physical || 0} æ ¸`,
                    `é€»è¾‘æ ¸å¿ƒ: ${data.cpu_count || 0}`
                ));

                // CPUæ ¸å¿ƒä½¿ç”¨ç‡
                if (data.cpu_per_core && data.cpu_per_core.length > 0) {
                    const coresCard = document.createElement('div');
                    coresCard.className = 'metric-card';

                    const coresHeader = document.createElement('div');
                    coresHeader.className = 'metric-header';

                    const coresIcon = document.createElement('div');
                    coresIcon.className = 'metric-icon';
                    coresIcon.style.backgroundColor = '#34495e';
                    coresIcon.innerHTML = '<i class="fas fa-th"></i>';

                    const coresTitle = document.createElement('div');
                    coresTitle.className = 'metric-title';
                    coresTitle.textContent = 'æ ¸å¿ƒä½¿ç”¨ç‡';

                    coresHeader.appendChild(coresIcon);
                    coresHeader.appendChild(coresTitle);
                    coresCard.appendChild(coresHeader);

                    const coresContainer = document.createElement('div');
                    coresContainer.className = 'cpu-cores';

                    data.cpu_per_core.forEach((usage, index) => {
                        const core = document.createElement('div');
                        core.className = 'cpu-core';

                        const coreValue = document.createElement('div');
                        coreValue.className = 'cpu-core-value';
                        coreValue.textContent = `æ ¸å¿ƒ ${index + 1}: ${formatPercentage(usage)}`;

                        core.appendChild(coreValue);
                        coresContainer.appendChild(core);
                    });

                    coresCard.appendChild(coresContainer);
                    container.appendChild(coresCard);
                }

            } catch (error) {
                console.error('è·å–CPUä¿¡æ¯å¤±è´¥:', error);
                container.innerHTML = '<div class="error">âŒ æ— æ³•è·å–CPUä¿¡æ¯</div>';
            }
        }

        // æ›´æ–°å†…å­˜ä¿¡æ¯
        async function updateMemoryInfo() {
            const container = document.getElementById('memory-info');

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/api/performance/resources`);
                const data = await response.json();

                container.innerHTML = '';

                // å†…å­˜ä½¿ç”¨ç‡
                container.appendChild(createMetricCard(
                    'fas fa-memory',
                    '#e74c3c',
                    'å†…å­˜ä½¿ç”¨ç‡',
                    formatPercentage(data.memory_usage),
                    '',
                    data.memory_usage
                ));

                // å·²ç”¨å†…å­˜
                container.appendChild(createMetricCard(
                    'fas fa-database',
                    '#3498db',
                    'å·²ç”¨å†…å­˜',
                    formatBytes((data.memory_used || 0) * 1024 * 1024 * 1024),
                    'ç‰©ç†å†…å­˜'
                ));

                // å¯ç”¨å†…å­˜
                container.appendChild(createMetricCard(
                    'fas fa-expand-arrows-alt',
                    '#27ae60',
                    'å¯ç”¨å†…å­˜',
                    formatBytes((data.memory_available || 0) * 1024 * 1024 * 1024),
                    'å‰©ä½™å®¹é‡'
                ));

                // äº¤æ¢å†…å­˜
                if (data.swap_total && data.swap_total > 0) {
                    container.appendChild(createMetricCard(
                        'fas fa-exchange-alt',
                        '#f39c12',
                        'äº¤æ¢å†…å­˜',
                        `${formatBytes((data.swap_used || 0) * 1024 * 1024 * 1024)} / ${formatBytes((data.swap_total || 0) * 1024 * 1024 * 1024)}`,
                        `ä½¿ç”¨ç‡: ${formatPercentage(data.swap_usage)}`
                    ));
                }

            } catch (error) {
                console.error('è·å–å†…å­˜ä¿¡æ¯å¤±è´¥:', error);
                container.innerHTML = '<div class="error">âŒ æ— æ³•è·å–å†…å­˜ä¿¡æ¯</div>';
            }
        }

        // æ›´æ–°ç£ç›˜ä¿¡æ¯
        async function updateDiskInfo() {
            const container = document.getElementById('disk-info');

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/api/performance/resources`);
                const data = await response.json();

                container.innerHTML = '';

                // ç£ç›˜ä½¿ç”¨ç‡
                container.appendChild(createMetricCard(
                    'fas fa-hdd',
                    '#e74c3c',
                    'ç£ç›˜ä½¿ç”¨ç‡',
                    formatPercentage(data.disk_usage),
                    '',
                    data.disk_usage
                ));

                // å·²ç”¨ç£ç›˜ç©ºé—´
                container.appendChild(createMetricCard(
                    'fas fa-folder',
                    '#f39c12',
                    'å·²ç”¨ç©ºé—´',
                    formatBytes((data.disk_used || 0) * 1024 * 1024 * 1024),
                    'ç£ç›˜å ç”¨'
                ));

                // æ€»ç£ç›˜ç©ºé—´
                container.appendChild(createMetricCard(
                    'fas fa-expand',
                    '#27ae60',
                    'æ€»å®¹é‡',
                    formatBytes((data.disk_total || 0) * 1024 * 1024 * 1024),
                    'ç£ç›˜æ€»å¤§å°'
                ));

                // ç£ç›˜IO
                if (data.disk_read_rate || data.disk_write_rate) {
                    const ioCard = document.createElement('div');
                    ioCard.className = 'metric-card';

                    const ioHeader = document.createElement('div');
                    ioHeader.className = 'metric-header';

                    const ioIcon = document.createElement('div');
                    ioIcon.className = 'metric-icon';
                    ioIcon.style.backgroundColor = '#9b59b6';
                    ioIcon.innerHTML = '<i class="fas fa-exchange-alt"></i>';

                    const ioTitle = document.createElement('div');
                    ioTitle.className = 'metric-title';
                    ioTitle.textContent = 'ç£ç›˜IO';

                    ioHeader.appendChild(ioIcon);
                    ioHeader.appendChild(ioTitle);
                    ioCard.appendChild(ioHeader);

                    const ioInfo = document.createElement('div');
                    ioInfo.className = 'disk-info';

                    const readItem = document.createElement('div');
                    readItem.className = 'disk-item';
                    readItem.innerHTML = `
                        <div style="color: #27ae60; font-size: 1.2em;"><i class="fas fa-download"></i></div>
                        <div style="font-size: 0.9em; color: #666;">è¯»å–</div>
                        <div style="font-weight: bold; color: #2c3e50;">${formatBytes(data.disk_read_rate * 1024 * 1024)}/s</div>
                    `;

                    const writeItem = document.createElement('div');
                    writeItem.className = 'disk-item';
                    writeItem.innerHTML = `
                        <div style="color: #e74c3c; font-size: 1.2em;"><i class="fas fa-upload"></i></div>
                        <div style="font-size: 0.9em; color: #666;">å†™å…¥</div>
                        <div style="font-weight: bold; color: #2c3e50;">${formatBytes(data.disk_write_rate * 1024 * 1024)}/s</div>
                    `;

                    ioInfo.appendChild(readItem);
                    ioInfo.appendChild(writeItem);
                    ioCard.appendChild(ioInfo);
                    container.appendChild(ioCard);
                }

            } catch (error) {
                console.error('è·å–ç£ç›˜ä¿¡æ¯å¤±è´¥:', error);
                container.innerHTML = '<div class="error">âŒ æ— æ³•è·å–ç£ç›˜ä¿¡æ¯</div>';
            }
        }

        // æ›´æ–°ç½‘ç»œä¿¡æ¯
        async function updateNetworkInfo() {
            const container = document.getElementById('network-info');

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/api/performance/resources`);
                const data = await response.json();

                container.innerHTML = '';

                const networkCard = document.createElement('div');
                networkCard.className = 'metric-card';

                const networkHeader = document.createElement('div');
                networkHeader.className = 'metric-header';

                const networkIcon = document.createElement('div');
                networkIcon.className = 'metric-icon';
                networkIcon.style.backgroundColor = '#27ae60';
                networkIcon.innerHTML = '<i class="fas fa-network-wired"></i>';

                const networkTitle = document.createElement('div');
                networkTitle.className = 'metric-title';
                networkTitle.textContent = 'ç½‘ç»œæµé‡';

                networkHeader.appendChild(networkIcon);
                networkHeader.appendChild(networkTitle);
                networkCard.appendChild(networkHeader);

                const networkInfoContainer = document.createElement('div');
                networkInfoContainer.className = 'network-info';

                const rxItem = document.createElement('div');
                rxItem.className = 'network-item';
                rxItem.innerHTML = `
                    <div style="color: #3498db; font-size: 1.5em;"><i class="fas fa-arrow-down"></i></div>
                    <div style="font-size: 0.9em; color: #666;">ä¸‹è¡Œ</div>
                    <div style="font-weight: bold; color: #2c3e50;">${formatBytes(data.network_rx * 1024)}/s</div>
                `;

                const txItem = document.createElement('div');
                txItem.className = 'network-item';
                txItem.innerHTML = `
                    <div style="color: #e74c3c; font-size: 1.5em;"><i class="fas fa-arrow-up"></i></div>
                    <div style="font-size: 0.9em; color: #666;">ä¸Šè¡Œ</div>
                    <div style="font-weight: bold; color: #2c3e50;">${formatBytes(data.network_tx * 1024)}/s</div>
                `;

                networkInfoContainer.appendChild(rxItem);
                networkInfoContainer.appendChild(txItem);
                networkCard.appendChild(networkInfoContainer);
                container.appendChild(networkCard);

                // ç½‘ç»œæ•°æ®åŒ…ç»Ÿè®¡
                if (data.network_packets_rx || data.network_packets_tx) {
                    container.appendChild(createMetricCard(
                        'fas fa-chart-bar',
                        '#9b59b6',
                        'æ•°æ®åŒ…ç»Ÿè®¡',
                        `${formatNumber(data.network_packets_rx)} / ${formatNumber(data.network_packets_tx)}`,
                        'æ¥æ”¶ / å‘é€'
                    ));
                }

            } catch (error) {
                console.error('è·å–ç½‘ç»œä¿¡æ¯å¤±è´¥:', error);
                container.innerHTML = '<div class="error">âŒ æ— æ³•è·å–ç½‘ç»œä¿¡æ¯</div>';
            }
        }

        // æ›´æ–°è¿›ç¨‹ä¿¡æ¯
        async function updateProcessInfo() {
            const container = document.getElementById('process-info');

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/api/performance/resources`);
                const data = await response.json();

                container.innerHTML = '';

                container.appendChild(createMetricCard(
                    'fas fa-cogs',
                    '#34495e',
                    'è¿è¡Œè¿›ç¨‹',
                    `${data.process_count || 0} ä¸ª`,
                    'ç³»ç»Ÿè¿›ç¨‹æ€»æ•°'
                ));

            } catch (error) {
                console.error('è·å–è¿›ç¨‹ä¿¡æ¯å¤±è´¥:', error);
                container.innerHTML = '<div class="error">âŒ æ— æ³•è·å–è¿›ç¨‹ä¿¡æ¯</div>';
            }
        }

        // æ›´æ–°æœ€ååˆ·æ–°æ—¶é—´
        function updateLastRefreshTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-CN');

            let lastUpdateEl = document.querySelector('.last-update');
            if (!lastUpdateEl) {
                lastUpdateEl = document.createElement('div');
                lastUpdateEl.className = 'last-update';
                document.querySelector('.header').appendChild(lastUpdateEl);
            }

            lastUpdateEl.textContent = `æœ€åæ›´æ–°: ${timeStr}`;
        }

        // æ›´æ–°æ€§èƒ½ä¿¡æ¯
        async function updatePerformanceInfo() {
            const container = document.getElementById('performance-info');

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/api/performance/resources`);
                const data = await response.json();

                // å¤„ç†Noneå€¼
                const performanceData = {
                    'CPUä½¿ç”¨ç‡': formatPercentage(data.cpu_usage),
                    'å†…å­˜ä½¿ç”¨ç‡': formatPercentage(data.memory_usage),
                    'å·²ç”¨å†…å­˜': formatBytes((data.memory_used || 0) * 1024 * 1024 * 1024),
                    'å¯ç”¨å†…å­˜': formatBytes((data.memory_available || 0) * 1024 * 1024 * 1024),
                    'ç£ç›˜ä½¿ç”¨ç‡': formatPercentage(data.disk_usage),
                    'å·²ç”¨ç£ç›˜': formatBytes((data.disk_used || 0) * 1024 * 1024 * 1024),
                    'æ€»ç£ç›˜ç©ºé—´': formatBytes((data.disk_total || 0) * 1024 * 1024 * 1024),
                    'ç½‘ç»œæ¥æ”¶': formatBytes(data.network_rx || 0) + '/s',
                    'ç½‘ç»œå‘é€': formatBytes(data.network_tx || 0) + '/s'
                };

                container.innerHTML = '';
                Object.entries(performanceData).forEach(([label, value]) => {
                    container.appendChild(createInfoItem(label, value));
                });

            } catch (error) {
                console.error('è·å–æ€§èƒ½ä¿¡æ¯å¤±è´¥:', error);
                container.innerHTML = '<div class="error">âŒ æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡ï¼Œè¯·æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ</div>';
            }
        }

        // åˆ·æ–°æ‰€æœ‰ä¿¡æ¯
        async function refreshAll() {
            await Promise.all([
                updateSystemInfo(),
                updateCpuInfo(),
                updateMemoryInfo(),
                updateDiskInfo(),
                updateNetworkInfo(),
                updateProcessInfo()
            ]);
        }

        // å¯åŠ¨è‡ªåŠ¨åˆ·æ–°
        function startAutoRefresh() {
            if (refreshTimer) {
                clearInterval(refreshTimer);
            }
            refreshTimer = setInterval(refreshAll, CONFIG.REFRESH_INTERVAL);
        }

        // åœæ­¢è‡ªåŠ¨åˆ·æ–°
        function stopAutoRefresh() {
            if (refreshTimer) {
                clearInterval(refreshTimer);
                refreshTimer = null;
            }
        }

        // è®¾ç½®ç›¸å…³å‡½æ•°
        function openSettings() {
            document.getElementById('settingsModal').style.display = 'block';
            loadCurrentSettings();
        }

        function closeSettings() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        function loadCurrentSettings() {
            // åŠ è½½å½“å‰åˆ·æ–°é—´éš”
            const currentInterval = localStorage.getItem('refreshInterval') || '2';
            document.getElementById('refreshInterval').value = currentInterval;

            // åŠ è½½å½“å‰ä¸»é¢˜
            const currentTheme = localStorage.getItem('theme') || 'light';
            setTheme(currentTheme);

            // åŠ è½½å½“å‰è¯­è¨€
            const currentLang = localStorage.getItem('language') || 'zh-CN';
            setLanguage(currentLang);
        }

        function saveSettings() {
            const interval = document.getElementById('refreshInterval').value;
            const theme = localStorage.getItem('theme') || 'light';
            const language = localStorage.getItem('language') || 'zh-CN';

            localStorage.setItem('refreshInterval', interval);
            localStorage.setItem('theme', theme);
            localStorage.setItem('language', language);

            CONFIG.REFRESH_INTERVAL = interval * 1000;
            startAutoRefresh();

            closeSettings();
            showNotification('è®¾ç½®å·²ä¿å­˜ï¼');
        }

        function setTheme(theme) {
            const body = document.body;
            const lightTheme = document.getElementById('lightTheme');
            const darkTheme = document.getElementById('darkTheme');

            if (theme === 'dark') {
                body.className = 'dark-theme';
                darkTheme.classList.add('active');
                lightTheme.classList.remove('active');
            } else {
                body.className = '';
                lightTheme.classList.add('active');
                darkTheme.classList.remove('active');
            }

            localStorage.setItem('theme', theme);
        }

        function toggleTheme() {
            const currentTheme = localStorage.getItem('theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            setTheme(newTheme);
        }

        function setLanguage(lang) {
            const langZh = document.getElementById('langZh');
            const langEn = document.getElementById('langEn');

            if (lang === 'en-US') {
                langEn.classList.add('active');
                langZh.classList.remove('active');
                document.documentElement.lang = 'en-US';
            } else {
                langZh.classList.add('active');
                langEn.classList.remove('active');
                document.documentElement.lang = 'zh-CN';
            }

            localStorage.setItem('language', lang);
        }

        function showNotification(message) {
            // åˆ›å»ºé€šçŸ¥å…ƒç´ 
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #27ae60;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 1001;
                font-size: 0.9em;
                animation: slideIn 0.3s ease;
            `;
            notification.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;

            document.body.appendChild(notification);

            // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // æ·»åŠ é€šçŸ¥åŠ¨ç”»æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åŠ è½½ä¿å­˜çš„è®¾ç½®
            loadCurrentSettings();

            refreshAll();
            startAutoRefresh();

            // é¡µé¢å¸è½½æ—¶åœæ­¢åˆ·æ–°
            window.addEventListener('beforeunload', stopAutoRefresh);
        });

        // å¯¼å‡ºå‡½æ•°ä¾›å…¨å±€ä½¿ç”¨
        window.refreshAll = refreshAll;
        window.openSettings = openSettings;
        window.closeSettings = closeSettings;
        window.toggleTheme = toggleTheme;
    </script>
</body>
</html>
